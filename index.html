<!doctype html>
<html lang="en">
<head>
    <title>Happy Hebrew Language Week 2026 ! שבוע השפה העברית ה'תשפ"ו שמח</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 900px;
      padding: 24px;
      box-sizing: border-box;
      text-align: center;
    }

    input[type="text"] {
      width: 100%;
      font-size: 16px;
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
      box-sizing: border-box;
    }

    #output {
      margin-top: 20px;
      display: flex;
      justify-content: center;
    }

    ul {
      margin: 0;
      padding-left: 20px;
      text-align: start;
    }
  </style>
</head>
<body>
  <div class="container">
    <input
      id="keyInput"
      type="text"
      placeholder="Loading ... טוען"
      autocomplete="off"
      disabled
    />
    <div id="output"></div>
  </div>

  <script>
    const FILE_1 = "eng_sigs.json.gz";
    const FILE_2 = "heb_sigs.json.gz";

    let mapping = {};

    const inputEl = document.getElementById("keyInput");
    const outputEl = document.getElementById("output");

    function sortKey(s) {
      return [...s.trim().normalize("NFC")]
        .sort((a, b) => a.localeCompare(b))
        .join("");
    }

    function startsWithHebrew(s) {
      if (!s) return false;
      const ch = [...s.trim()][0];
      return /\p{Script=Hebrew}/u.test(ch);
    }

    function render(words, rtl) {
      outputEl.replaceChildren();
      if (!words || words.length === 0) return;

      const ul = document.createElement("ul");
      ul.dir = rtl ? "rtl" : "ltr";

      for (const w of words) {
        const li = document.createElement("li");
        li.textContent = w;
        ul.appendChild(li);
      }
      outputEl.appendChild(ul);
    }

    function updateLookup() {
      const raw = inputEl.value;
      if (!raw.trim()) return render([]);

      const key = sortKey(raw);
      const words = Object.prototype.hasOwnProperty.call(mapping, key)
        ? mapping[key]
        : [];

      render(Array.isArray(words) ? words : [], startsWithHebrew(raw));
    }

    inputEl.addEventListener("input", updateLookup);

    async function gunzipToText(uint8) {
      if (!("DecompressionStream" in window)) {
        throw new Error("DecompressionStream('gzip') not supported");
      }
      const ds = new DecompressionStream("gzip");
      const decompressed = new Blob([uint8]).stream().pipeThrough(ds);
      return await new Response(decompressed).text();
    }

    async function fetchAndLoadGzJson(url) {
      const resp = await fetch(url, { cache: "no-store" });
      if (!resp.ok) throw new Error(`Fetch failed for ${url}`);
      const buf = await resp.arrayBuffer();
      const text = await gunzipToText(new Uint8Array(buf));

      const obj = JSON.parse(text);
      if (obj === null || typeof obj !== "object" || Array.isArray(obj)) {
        throw new Error("JSON root must be an object");
      }
      return obj;
    }

    function normalizeAndSortMapping(obj) {
      const out = {};
      for (const [k, v] of Object.entries(obj)) {
        const sk = sortKey(k)
          .replace(/[\u200E\u200F]/g, "")
          .trim();
        out[sk] = v;
      }
      return out;
    }

    function mergeMappings(target, src) {
      for (const [k, v] of Object.entries(src)) {
        const arr = Array.isArray(v) ? v : [];
        if (!Object.prototype.hasOwnProperty.call(target, k)) {
          target[k] = arr.slice();
        } else {
          const seen = new Set(target[k]);
          for (const word of arr) {
            if (!seen.has(word)) {
              target[k].push(word);
              seen.add(word);
            }
          }
        }
      }
    }

    (async () => {
      const [m1, m2] = await Promise.all([
        fetchAndLoadGzJson(FILE_1),
        fetchAndLoadGzJson(FILE_2),
      ]);

      const merged = {};
      mergeMappings(merged, normalizeAndSortMapping(m1));
      mergeMappings(merged, normalizeAndSortMapping(m2));
      mapping = merged;

      inputEl.disabled = false;
      inputEl.placeholder = "Enter a word כתבו משהו כאן";
      inputEl.focus();
      updateLookup();
    })().catch(() => {
      // intentionally silent
    });
  </script>
</body>
</html>
